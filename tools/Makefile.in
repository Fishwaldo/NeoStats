include ../Makefile.inc

INCLUDES = -I.. -I../keeper/ -I../adns/ -DHAVE_CONFIG_H -DDST_DIR=@prefix@

KP_SOURCES= kp_exp.c kp_imp.c kptool.c
KP_OBJECTS= kp_exp.o kp_imp.o kptool.o
all:	kptool @build_configtool@

utils:  kptool @build_configtool@

.c.o:
	$(CC) $(CFLAGS) $(INCLUDES) -c $<
kptool:	$(KP_OBJECTS)
	$(CC) $(KP_OBJECTS) ../adns/libadns.a ../keeper/libkeeper.a -o $@

configtool:
	(cd cfgtool; $(MAKE) $@)

clean:
	(cd cfgtool; $(MAKE) $@)
	/bin/rm -rf *.o *.lo *.so *.a kptool Makefile


install: 
	$(INSTALL) -m 755 kptool @prefix@
	$(INSTALL) -m 644 README.kptool @prefix@
	@for blah in @build_configtool@; do \
		echo "Installing ConfigTool"; \
		$(INSTALL) -m 755 cfgtool/configtool @prefix@; \
		$(INSTALL) -m 644 cfgtool/README.configtool @prefix@; \
	done


$(OBJECTS): Makefile ../Makefile.inc
kp_exp.o: kp_exp.c kptool.h ../config.h ../keeper/keeper.h
kp_imp.o: kp_imp.c kptool.h ../config.h ../keeper/keeper.h
kptool.o: kptool.c kptool.h ../config.h ../keeper/keeper.h
