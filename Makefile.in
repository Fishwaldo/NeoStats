# Makefile for NeoStats
# NeoStats CVS Identification
# $Id: Makefile.in 581 2003-09-20 08:44:59Z Fish $
# makefile originally created by Andy Church.
include Makefile.inc 

PCRE_OBJS = pcre/pcre.o pcre/get.o pcre/study.o

OBJS =	dns.o chans.o dotconf.o services.o main.o sock.o conf.o ircd.o timer.o \
		 users.o ns_help.o dl.o list.o hash.o server.o keeper.o log.o misc.o \
		 support.o ircstring.o \
		 @IRCD_FILES_OBJS@
SRCS =	dns.c chans.c dotconf.c services.c main.c sock.c conf.c ircd.c timer.c \
		users.c ns_help.c dl.c list.c hash.c server.c keeper.c log.c misc.c \
		support.c ircstring.c \
		@IRCD_FILES_SRC@

PROGS = neostats cronchk makeconf
CONF = neostats.motd
DOCS = doc/FAQ doc/USERMAN README BUGS AUTHORS COPYING CREDITS TODO \
		tools/README* tools/cfgtool/README* ChangeLog
DOCS_PROGS = doc/read-faq doc/read-userman
DATA = data/tlds.nfo
INCLUDES = config.h dl.h dotconf.h hash.h list.h stats.h Ultimate.h Unreal.h \
		adns/adns.h hybrid7.h neoircd.h conf.h log.h Bahamut.h \
		Ircu.h mystic.h QuantumIRCd.h sock.h ircd.h \
		support.h ircstring.h events.h liquidircd.h numeric.h pcre.h
BUILDFILES = configure *.in adns/Makefile adns/config.h.in dl/Makefile \
		dl/modules.txt RELNOTES install-sh neoircd.c neoircd.h \
		hybrid7.c hybrid7.h Ultimate.c Ultimate.h Unreal.c Unreal.h \
		makeconf cronchk tools/Makefile.in tools/cfgtool/Makefile \
		keeper/Makefile doc/old/* Bahamut.c Ircu.c mystic.c \
		QuantumIRCd.c Config liquidircd.c
TOOLFILES = tools/*.c tools/*.h tools/cfgtool/*.h tools/cfgtool/*.c \
		tools/cfgtool/pixmaps/*.xpm
DISTFILES = $(INCLUDES) $(SRCS) $(DATA) $(DOCS) $(DOCS_PROGS) $(CONF) \
		$(BUILDFILES) $(TOOLFILES) keeper/*.c keeper/*.h adns/*.c \
		adns/adns.h adns/dlist.h  adns/internal.h  adns/tvarith.h \
		ns_help.h timer.h users.h chans.h server.h

 
distdir = @PACKAGE@-@VERSION@
SUBDIRS = doc doc/old data adns logs keeper tools tools/cfgtool \
		tools/cfgtool/pixmaps pcre
DISTMOD = cs extauth hostserv loveserv ms spam statserv version template

.c.o:
	$(CC) $(NEOINCLUDES) $(CFLAGS) -c $< 


all: 	libadns.a libkeeper.a libpcre neostats modules utils

modules:
	(cd dl; $(MAKE) $@)

libadns.a:
	(cd adns; $(MAKE) $@)

libkeeper.a:
	(cd keeper; $(MAKE) $@)

libpcre:
	(cd pcre; $(MAKE))

utils:
	(cd tools; $(MAKE) $@)


clean:
	(cd dl; $(MAKE) $@)
	(cd adns; $(MAKE) $@)
	(cd keeper; $(MAKE) $@)
	(cd tools; $(MAKE) $@)
	(cd pcre; $(MAKE) $@)
	/bin/rm -rf *.o neostats *.cache Makefile config.h  Makefile.inc *.log *.a


neostats: $(OBJS)
	$(CC) $(LDFLAGS) $(OBJS) adns/libadns.a keeper/libkeeper.a $(PCRE_OBJS) -o $@

install: neostats modules
	@rm -rf @prefix@/dl/cs.so
	@rm -rf @prefix@/dl/ms.so
	@rm -rf @prefix@/dl/SecureServ.so
	$(INSTALL) -m 755 -d @prefix@
	$(INSTALL) -m 755 -d @prefix@/dl
	$(INSTALL) -m 755 -d @prefix@/include
	$(INSTALL) -m 755 -d @prefix@/doc
	$(INSTALL) -m 755 -d @prefix@/data
	$(INSTALL) -m 750 -d @prefix@/logs
	$(INSTALL) -m 755 $(PROGS) @prefix@
	$(INSTALL) -m 644 $(CONF) @prefix@
	$(INSTALL) -m 644 $(DOCS) @prefix@/doc
	$(INSTALL) -m 755 $(DOCS_PROGS) @prefix@/doc
	$(INSTALL) -m 644 $(DATA) @prefix@/data
	$(INSTALL) -m 644 $(INCLUDES) @prefix@/include
	(cd dl; $(MAKE) $@)
	(cd tools; $(MAKE) $@)

dist: 	
	@echo -n "Creating Directories"
	@-rm -rf $(distdir)
	@echo -n "."
	@mkdir $(distdir)
	@echo -n "."
	@mkdir $(distdir)/dl
	@echo -n "."
	@for subdir in $(SUBDIRS); do \
		echo -n "."; \
		mkdir $(distdir)/$$subdir; \
		chmod 777 $(distdir)/$$subdir; \
	done
	@echo "Done"
	@echo -n "Coping Core Distribution files"
	@for file in $(DISTFILES); do \
		echo -n "."; \
		cp -pr $$file $(distdir)/$$file; \
	done
	@rm -rf $(distdir)/config.h
	@rm -rf $(distdir)/configure.in
	@echo "Done"
	@echo "Copying Module Distribution files"
	@for mod in $(DISTMOD); do \
		mkdir $(distdir)/dl/$$mod; \
		(cd dl/$$mod && $(MAKE) dist distdir=../../$(distdir)/dl/$$mod && cd ../..) || exit 1; \
	done
	@echo "Done"
	@tar -czf $(distdir).tar.gz $(distdir)/*
#	@rm -rf $(distdir)
	@echo "Tar file $(distdir).tar.gz created. Freshmeat time!"




# Catch any changes in compilation options at the top of this file
$(OBJS): Makefile

dns.o: dns.c stats.h adns/adns.h list.h hash.h config.h neoircd.h log.h
chans.o: chans.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h log.h
dotconf.o: dotconf.c dotconf.h
services.o: services.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h log.h
main.o: main.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h conf.h log.h
sock.o: sock.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h conf.h log.h
conf.o: conf.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dotconf.h conf.h dl.h log.h
ircd.o: ircd.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h log.h
timer.o: timer.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h log.h
users.o: users.c stats.h adns/adns.h list.h hash.h config.h neoircd.h dl.h log.h
ns_help.o: ns_help.c stats.h adns/adns.h list.h hash.h config.h neoircd.h
dl.o: dl.c dl.h hash.h stats.h adns/adns.h list.h config.h neoircd.h log.h
list.o: list.c list.h
hash.o: hash.c hash.h
server.o: server.c stats.h adns/adns.h list.h hash.h config.h neoircd.h log.h
keeper.o: keeper.c stats.h adns/adns.h list.h hash.h config.h neoircd.h keeper/keeper.h conf.h log.h
log.o: log.c stats.h adns/adns.h list.h hash.h config.h neoircd.h conf.h log.h
neoircd.o: neoircd.c stats.h adns/adns.h list.h hash.h config.h neoircd.h hybrid7.h dl.h log.h
