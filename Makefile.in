# Makefile for GeoStats
# GeoStats CVS Identification
# $Id: Makefile.in,v 1.36 2003/04/09 14:29:49 fishwaldo Exp $
# makefile originally created by Andy Church.
include Makefile.inc 


OBJS =	dns.o chans.o dotconf.o services.o main.o sock.o conf.o ircd.o timer.o users.o \
		ns_help.o dl.o list.o hash.o server.o keeper.o @IRCD_FILES_OBJS@
SRCS =	dns.c chans.c dotconf.c services.c main.c sock.c conf.c ircd.c timer.c users.c \
		ns_help.c dl.c list.c hash.c server.c keeper.c @IRCD_FILES_SRC@

PROGS = neostats cronchk makeconf
CONF = neostats.motd
DOCS = doc/FAQ* doc/USERMAN README* BUGS AUTHORS COPYING CREDITS INSTALL* LICENCE NEWS TODO
DOCS_PROGS = doc/read-faq doc/read-userman
DATA = data/tlds.nfo
INCLUDES = config.h dl.h dotconf.h hash.h list.h stats.h Ultimate.h Unreal.h adns/adns.h hybrid7.h neoircd.h conf.h
BUILDFILES = configure *.in adns/Makefile adns/config.h.in dl/Makefile dl/modules.txt RelNotes.txt install-sh neoircd.* hybrid7.* Ultimate.* Unreal.* makeconf cronchk
DISTFILES = $(INCLUDES) $(SRCS) $(DATA) $(DOCS) $(DOCS_PROGS) $(CONF) $(BUILDFILES) adns/*.c adns/adns.h adns/dlist.h  adns/internal.h  adns/tvarith.h
 
distdir = @PACKAGE@-@VERSION@
SUBDIRS = doc data adns logs keeper tools tools/configtool
DISTMOD = cs extauth hostserv loveserv ms spam statserv version 

.c.o:
	$(CC) $(NEOINCLUDES) $(CFLAGS) -c $< 


all: 	libadns.a libkeeper.a neostats modules utils

modules:
	(cd dl; $(MAKE) $@)

libadns.a:
	(cd adns; $(MAKE) $@)

libkeeper.a:
	(cd keeper; $(MAKE) $@)

utils:
	(cd tools; $(MAKE) $@)

clean:
	(cd dl; $(MAKE) $@)
	(cd adns; $(MAKE) $@)
	(cd keeper; $(MAKE) $@)
	(cd tools; $(MAKE) $@)
	/bin/rm -rf *.o neostats *.cache Makefile config.h  Makefile.inc *.log *.a


neostats: $(OBJS)
	$(CC) $(LDFLAGS) $(OBJS) adns/libadns.a keeper/libkeeper.a -o $@

install: neostats modules
	$(INSTALL) -m 755 -d @prefix@
	$(INSTALL) -m 755 -d @prefix@/dl
	$(INSTALL) -m 755 -d @prefix@/include
	$(INSTALL) -m 755 -d @prefix@/doc
	$(INSTALL) -m 755 -d @prefix@/data
	$(INSTALL) -m 750 -d @prefix@/logs
	$(INSTALL) -m 755 $(PROGS) @prefix@
	$(INSTALL) -m 644 $(CONF) @prefix@
	$(INSTALL) -m 644 $(DOCS) @prefix@/doc
	$(INSTALL) -m 755 $(DOCS_PROGS) @prefix@/doc
	$(INSTALL) -m 644 $(DATA) @prefix@/data
	$(INSTALL) -m 644 $(INCLUDES) @prefix@/include
	(cd dl; $(MAKE) $@)

dist: 	
	@echo -n "Creating Directories"
	@-rm -rf $(distdir)
	@echo -n "."
	@mkdir $(distdir)
	@echo -n "."
	@mkdir $(distdir)/dl
	@echo -n "."
	@for subdir in $(SUBDIRS); do \
		echo -n "."; \
		mkdir $(distdir)/$$subdir; \
		chmod 777 $(distdir)/$$subdir; \
	done
	@echo "Done"
	@echo -n "Coping Core Distribution files"
	@for file in $(DISTFILES); do \
		echo -n "."; \
		cp -pr $$file $(distdir)/$$file; \
	done
	@rm -rf $(distdir)/config.h
	@rm -rf $(distdir)/configure.in
	@echo "Done"
	@echo "Copying Module Distribution files"
	@for mod in $(DISTMOD); do \
		mkdir $(distdir)/dl/$$mod; \
		(cd dl/$$mod && $(MAKE) dist distdir=../../$(distdir)/dl/$$mod && cd ../..) || exit 1; \
	done
	@echo "Done"
	@tar -czf $(distdir).tar.gz $(distdir)/*
	@rm -rf $(distdir)
	@echo "Tar file $(distdir).tar.gz created. Freshmeat time!"




# Catch any changes in compilation options at the top of this file
$(OBJS): Makefile

dotconf.o:	dotconf.c	stats.h		config.h	dotconf.h	Makefile.inc
services.o:	services.c	stats.h		config.h	dl.h		Unreal.h  	Ultimate.h	Makefile.inc
main.o:		main.c		stats.h 	config.h	dl.h		Makefile.inc
sock.o:		sock.c		stats.h		config.h	dl.h		Makefile.inc
conf.o:		conf.c		stats.h		config.h	dotconf.h	dl.h		Makefile.inc
ircd.o:		ircd.c		stats.h		config.h	dl.h	 	Unreal.h 	Ultimate.h	Makefile.inc
timer.o:	timer.c		stats.h		config.h	dl.h		Makefile.inc
users.o:	users.c		stats.h		config.h	Makefile.inc
ns_help.o:	ns_help.c	stats.h		config.h	Makefile.inc
dl.o:		dl.c		stats.h		config.h	dl.h		Makefile.inc
list.o:		list.c		list.h		Makefile.inc
hash.o:		hash.c		hash.h		Makefile.inc
server.o:	server.c	stats.h		hash.h		hash.c	 	config.h	Makefile.inc
Ultimate.o:	Ultimate.c	stats.h		Ultimate.h	Makefile.inc
Unreal.o:	Unreal.c	stats.h		Unreal.h	Makefile.inc
chans.o:	hash.c		stats.h		Makefile.inc
hybrid7.o:	hybrid7.c	stats.h		hybrid7.h	Makefile.inc
neoircd.o:	neoircd.c	stats.h		neoircd.h	Makefile.inc
