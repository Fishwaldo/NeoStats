#!/bin/sh
#
# NeoStats Crontab v2.1
# $Id: cronchk,v 1.1 2002/10/24 14:31:08 fishwaldo Exp $
#
# This is a script suitable for use in a crontab.  It checks to make sure
# your neostats is running.  
# if NeoStats isn't found, it'll try to start it back up.
#
# You'll need to edit this script for your copy of NeoStats
#
# To check for your Neostats every 10 minutes, put the following line in your
# crontab:
#    0,10,20,30,40,50 * * * *   /home/mydir/ircdchk
# And if you don't want to get email from crontab when it checks you Neostats,
# put the following in your crontab:
#    0,10,20,30,40,50 * * * *   /home/mydir/ircdchk >/dev/null 2>&1
#
# This file originally came from UnrealIRCd

# change this to the mail address to mail output to:
MAIL=me
# change this to the directory you run your ircd from:
dir="/path/to/neostats"

# change this to the name of your Neostats file in that directory:
ircdexe="neostats"

# I wouldn't touch this if I were you.
ircdname="neostats.pid"

########## you probably don't need to change anything below here ##########

cd $dir
if test -r $ircdname; then
  # there is a pid file -- is it current?
  ircdpid=`cat $ircdname`
  if `kill -CHLD $ircdpid >/dev/null 2>&1`; then
    # it's still going
    # back out quietly
    exit 0
  fi
  echo "UnrealIRCd Crontab notice:"
  echo ""
  echo "Stale $ircdname file (erasing it)"
  rm -f $ircdname
fi
echo ""
echo "Couldn't find NeoStats running.  Reloading it..."
echo ""
./$ircdexe
