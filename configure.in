dnl Process this file with autoconf to produce a configure script.
AC_INIT(dl.c)
AC_CONFIG_HEADER(config.h)

PACKAGE=NeoStats
VERSION=2.5.0
AC_PREFIX_DEFAULT(~/NeoStats/)
CFLAGS="$CFLAGS -O2 -Wall"

dnl Checks for programs.
AC_PROG_CC

dnl Checks for libraries.
dnl Replace `main' with a function in -ldl:
AC_CHECK_LIB(dl, dlopen)

dnl Checks for header files.
AC_HEADER_STDC
AC_HEADER_SYS_WAIT
AC_CHECK_HEADERS(sys/time.h unistd.h db.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_TYPE_SIZE_T
AC_HEADER_TIME
AC_STRUCT_TM

dnl Checks for library functions.
AC_FUNC_FNMATCH
AC_TYPE_SIGNAL
AC_FUNC_STRFTIME
AC_CHECK_FUNCS(regcomp select socket strdup)

dnl check if we are running with Debug....
AC_MSG_CHECKING(Whether to Enable Debuging...)
AC_ARG_ENABLE(debug,
[ --enable-debug - Enable Debuging],
[ case "$enableval" in
  yes)
	AC_DEFINE(DEBUG)
	CFLAGS="$CFLAGS -ggdb"
	AC_MSG_RESULT(yes - Watch your Log Files)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
  esac],
AC_MSG_RESULT(no)
)

dnl check to see if we should enable Unreal IRCD Support
AC_MSG_CHECKING(Whether to Enable Unreal IRCD Support...)
AC_ARG_ENABLE(unreal, [ --enable-unreal - enable Unreal IRCD Support],
[ case "$enableval" in
  yes)  
	AC_DEFINE(UNREAL)
	IRCD_FILES_SRC="Unreal.c"
	IRCD_FILES_OBJS="Unreal.o"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
AC_MSG_RESULT(no))

dnl check to see if we should enable Ultimate IRCD Support
AC_MSG_CHECKING(Whether to Enable Ultimate IRCD Support...)
AC_ARG_ENABLE(ultimate, [ --enable-ultimate - enable Ultimate IRCD Support],
[ case "$enableval" in
  yes)  
	AC_DEFINE(ULTIMATE)
	IRCD_FILES_SRC="Ultimate.c"
	IRCD_FILES_OBJS="Ultimate.o"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
AC_MSG_RESULT(no)
)
dnl check to see what type of authentication to use
AC_MSG_CHECKING(What type of Authentication to use...)
AC_ARG_ENABLE(auth, [ --enable-auth==TYPE - what type of Authentication to use. Options are IRCD, or ROOT or EXT],
[ case "$enableval" in
  IRCD)  
	AC_DEFINE(IRCDAUTH)
	AC_MSG_RESULT(IRCD)
	;;
  ROOT)
	AC_DEFINE(SHMADAUTH)
	AC_MSG_RESULT(ROOT)
	;;
  EXT)	AC_DEFINE(EXTAUTH)
	AC_MSG_RESULT(EXT)
	;;
  *)
	AC_DEFINE(IRCDAUTH)
	AC_MSG_RESULT(IRCD)
	;;
esac],
AC_DEFINE(IRCDAUTH)
AC_MSG_RESULT(IRCD)
)

dnl Lets see what Modules to Compile
AC_MSG_CHECKING(Whether to Enable StatServ Module?)
AC_ARG_ENABLE(statserv,
[ --disable-statserv - Do Not Compile StatServ Module],
[ case "$enableval" in
  yes)  
	MODULES="statserv"
	AC_MSG_RESULT(yes)
	;;
  *) 
	AC_MSG_RESULT(no)
	;;
esac],
[MODULES="statserv"
AC_MSG_RESULT(yes)
])

AC_MSG_CHECKING(Whether to Enable Spam Module?)
AC_ARG_ENABLE(spam,
[ --disable-spam - Do Not Compile Spam Module],
[ case "$enableval" in
  yes)  
	MODULES="$MODULES spam"
	AC_MSG_RESULT(yes)
	;;
  *) 
	AC_MSG_RESULT(no)
	;;
esac],
[ MODULES="$MODULES spam"
AC_MSG_RESULT(yes)
])

AC_MSG_CHECKING(Whether to Enable Icq Module?)
AC_ARG_ENABLE(icq,
[ --enable-icq - Do Compile Icq Module],
[ case "$enableval" in
  yes)  
	MODULES="$MODULES icq"
	AC_MSG_RESULT(yes)
	;;
  *) 
	AC_MSG_RESULT(no)
	;;
esac],
[AC_MSG_RESULT(no)
])
	
AC_MSG_CHECKING(Whether to Enable Version Module?)
AC_ARG_ENABLE(version,
[ --enable-version - Do Compile Version Module (API example)],
[ case "$enableval" in
  yes)
	MODULES="$MODULES version"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
[AC_MSG_RESULT(no)]
)

AC_MSG_CHECKING(Whether to Enable Netinfo Module?)
AC_ARG_ENABLE(netinfo,
[ --enable-netinfo - Do Compile NetInfo Module],
[ case "$enableval" in
  yes)
	MODULES="$MODULES netinfo"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
[AC_MSG_RESULT(no)]
)

AC_MSG_CHECKING(Whether to Enable Services Module?)
AC_ARG_ENABLE(services,
[ --enable-services - Do Compile Services Module],
[ case "$enableval" in
  yes)
	MODULES="$MODULES services"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
[AC_MSG_RESULT(no)]
)

AC_MSG_CHECKING(Whether to Enable LoveServ Module?)
AC_ARG_ENABLE(loveserv,
[ --enable-loveserv - Do Compile LoveServ Module],
[ case "$enableval" in
  yes)
	MODULES="$MODULES loveserv"
	AC_MSG_RESULT(yes)
	;;
  *)
	AC_MSG_RESULT(no)
	;;
esac],
[AC_MSG_RESULT(no)]
)
dnl Lets see what Modules to Compile
AC_MSG_CHECKING(Any other modules to compile?)
AC_ARG_ENABLE(modules, [ --enable-modules="MODULES" - space seperated list of modules to compile],
AC_MSG_RESULT($enableval) 
MODULES="$MODULES $enableval",
AC_MSG_RESULT(none)
)


AC_MSG_CHECKING(Your Current Bank Balance)
AC_MSG_RESULT(Thats Impressive!!!)
AC_MSG_CHECKING(The Modules that will be compiled)
AC_MSG_RESULT($MODULES)


AC_SUBST(IRCD_FILES_SRC)
AC_SUBST(IRCD_FILES_OBJS)
AC_SUBST(MODULES)
AC_SUBST(LIBS)
AC_OUTPUT(dl/statserv/Makefile dl/services/Makefile dl/icq/Makefile dl/version/Makefile dl/Makefile dl/spam/Makefile dl/netinfo/Makefile Makefile dl/services/Makefile dl/loveserv/Makefile)
echo "(*----------------------------------------------------------*)"
echo "(| Important Instructions                                   |)"
echo "(*----------------------------------------------------------*)"
echo "(| if you just typed ./configure and didnt read the README  |)"
echo "(| NeoStats may not be configured correctly                 |)"
echo "(| We Suggest you at least type ./configure --help          |)"
echo "(| To see available options and read the Readme file for    |)"
echo "(| further information on that option                       |)"
echo "(*----------------------------------------------------------*)"
echo "(| For Support please visit:                                |)"
echo "(|    IRC:                   /server irc.irc-chat.net       |)"
echo "(|                           /server irc.neostats.net       |)"
echo "(|                                   #neostats channel      |)"
echo "(|    WWW:   http://www.neostats.net/cgi-bin/forum.cgi      |)"
echo "(|           http://www.sf.net/projects/neostats/           |)"
echo "(*----------------------------------------------------------*)"
echo "(| Now that Configure is complete, just type "make" to        |)"
echo "(| compile the program                                      |)"
echo "(*----------------------------------------------------------*)"
